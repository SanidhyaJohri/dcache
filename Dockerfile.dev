FROM golang:1.22-alpine AS dev

RUN apk add --no-cache git make

# Use older air version compatible with Go 1.22
RUN go install github.com/cosmtrek/air@v1.49.0

WORKDIR /app

COPY go.* ./
RUN go mod download || true

COPY . .

EXPOSE 8080 6379

CMD ["air"]
